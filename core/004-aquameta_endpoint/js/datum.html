<html>
    <head>
        <script src='/system.js'></script>
        <script>
        System.import('/Datum.js').then(function() {

            /* 
            Decisions to make:
                - how to stucture our OOP
                - style guide
            */

            var db = new AQ.Database('/endpoint/new', { evented: 'no' });
// Rows
/*
            // Fail with does not exist
            db.schema('beta').relation('melation').rows({
                where: [{ name: 'name', op: 'like', value: '%res%' }]
            }).then(function(r) {
                console.log('where', r);
            }, function(err) {
                console.error(err);
            });
            // Where
            db.schema('meta').relation('relation').rows({
                where: [{ name: 'name', op: 'like', value: '%res%' }]
            }).then(function(r) { console.log('where', r); });

            // Order by
            db.schema('meta').relation('relation').rows({
                order_by: { name: 'desc' }
            }).then(function(r) { console.log('order_by', r); });

            // Limit
            db.schema('meta').relation('relation').rows({
                limit: 5
            }).then(function(r) { console.log('limit', r); });

            // Offset
            db.schema('meta').relation('relation').rows({
                offset: 5
            }).then(function(r) { console.log('offset', r); });

            // Exclude columns
            db.schema('meta').relation('relation').rows({
                exclude: ['id', 'name', 'schema_name', 'schema_id']
            }).then(function(r) { console.log('exclude', r); });
*/



// Row
            // No arguments
            /*
            db.schema('endpoint').relation('session').row()
            .then(function(r) {
                console.log('select row: no args', r);
            });

            // Key and value
            db.schema('meta').relation('relation').row('name', 'resource_file')
            .then(function(r) {
                console.log('select row: key, value', r);
            });

            // Where is an object
            db.schema('widget').relation('widget').row({ name: 'id', op: '=', value: '17a50da2-eba6-4295-8875-a6936ca4109e'})
            .then(function(r) {
                console.log('select row: obj', r);
            });

            // Where is an object
            db.schema('widget').relation('widget').row({ where: { name: 'id', op: '=', value: '17a50da2-eba6-4295-8875-a6936ca4109e'}})
            .then(function(r) {
                console.log('select row: obj with where', r);
            });

            // Fail with no row found
            db.schema('widget').relation('widget').row({ where: { name: 'id', op: '=', value: '17a50da2-eba6-4295-8875-a6936ca4109a'}})
            .then(function(r) {
                // doesn't return row. 400 is logged. 
                console.log('breaking select', r);
            }, function(err) {
                console.error('failing select: no row found');
                console.error(err);
            });
            
            // Fail with invalid uuid
            db.schema('widget').relation('widget').row({ where: { name: 'id', op: '=', value: '17a50da2-eba6-4295-8875-a6936ca4109ezzz'}})
            .then(function(r) {
                // doesn't return row. 400 is logged. 
                console.log('breaking select', r);
            }, function(err) {
                console.error('failing select from invalid uuid');
                console.error(err);
            });
            */

// Insert row
            /*
            db.schema('widget').table('widget').insert({ name: 'hello' + Math.floor(Math.random()*100 + 1) })
            .then(function(r) {
                console.log('insert', r);
            });

            // Fail
            db.schema('widget').table('widget').insert({ id: 'hello2z' })
            .then(function(row) {
                console.log('failing insert: invalid uuid', row);
            }, function(err) {
                console.error(err);
            });
            */

// Multiple row insert
            /*
            db.schema('widget').table('widget').insert([
                { name: 'hello' + Math.floor(Math.random()*100 + 1) },
                { name: 'hello' + Math.floor(Math.random()*100 + 1) },
                { name: 'hello' + Math.floor(Math.random()*100 + 1) }
            ]).then(function(rows) {
                console.log('inserted multiple rows', rows);
            });
            */


// Update row
            /*
            db.schema('widget').table('widget').insert({ name: 'hello' + Math.floor(Math.random()*100 + 1) })
            .then(function(row) {

                var old_name = row.get('name');
                var new_name = old_name + 1;
                console.log('inserted', old_name, 'and updating to', new_name);
                return row.set('id', 'lkjsdlfkjs').update();

            }).then(function(r) {
                console.log('updated to', r.get('name'), r);
            }).catch(function(err) {
                console.error(err);
            });
            */

// Delete row
            /*
            db.schema('widget').table('widget').insert({ name: 'hello' + Math.floor(Math.random()*100 + 1) })
            .then(function(row) {

                console.log('insert worked', row, row.get('name'), 'and deleting');

                return row.delete().then(function(r) {
                    console.log('delete worked', r);
                }, function(r) {
                    console.error('delete broke', r);
                    throw r;
                });

            }, function(err) {
                console.log('insert broke', err);
                throw err;
            }).catch(function(err) {
                console.error('one of the above broke', err);
            });
            */

// Function
            /*
            // Function with no arguments - string arguments
            db.schema('public').function('uuid_generate_v4', '{}').call()
            .then(function(result) {
                console.log(result);
            });

            // Function with no arguments - array arguments
            db.schema('public').function('uuid_generate_v4', []).call()
            .then(function(result) {
                console.log(result);
            });

// Function with multiple arguments
            // Function with array args selector and array arguments
            db.schema('meta').function('relation_id', ['text', 'text']).call(['meta', 'relation'])
            .then(function(result) {
                console.log(result);
            });

            // Function with string args selector and array arguments
            db.schema('meta').function('relation_id', '{text, text}').call(['meta', 'relation'])
            .then(function(result) {
                console.log(result);
            });

            // Function with key/value pair arguments
            db.schema('meta').function('relation_id', '{text, text}').call({
               schema_name: 'meta',
               name: 'relation'
            })
            .then(function(result) {
                console.log(result);
            });
            */


// --------------------
// Not yet tested below
// --------------------

// Select with composite type
// Insert composite type
// Update composite type
// Delete with composite type

// Rows related rows
// Rows related row

// Row related rows
// Row related row

// Row select that is upgraded to POST
// Rows select that is upgraded to POST


        });
        </script>
    </head>
    <body>
        <h1>datum.html</h1>
    </body>
</html>
